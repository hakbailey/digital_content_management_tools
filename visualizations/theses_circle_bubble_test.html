<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="utf-8">
      <title>Theses Content Type</title>
      <script type="text/javascript" src="d3/d3.v3.js"></script>
      <script type="text/javascript" src="d3/d3.layout.js"></script>
			<style type="text/css">
				svg .primaryBucket {
					stroke: black;
					stroke-width: 4;	
					fill-opacity: 0.5;			
				}
			</style>
    </head>

    <body>
      <script type="text/javascript">
			// var xVals = [];
			// var yVals = [];
			var jsonData;
			
			var w = 1000;
			var h = 600;

			var bubble = d3.layout.pack()
			    .sort(null)
			    .size([w, h])
			    .padding(1.5);

			// for (var i = 0; i < 12; i++) {
			// 	var newValx = Math.round(Math.random() * (w - 200) + 100);
			// 	xVals.push(newValx);
			// }

			// for (var i = 0; i < 12; i++) {			
			// 	var newValy = Math.round(Math.random() * (h - 200) + 100);
			// 	yVals.push(newValy);
			// }

			var svg = d3.select("body")
				.append("svg")
				.attr("width", w)
				.attr("height", h)
				.attr("class", "bubble");

			d3.json("data/theses.json", function(error, root) {

				var node = svg.selectAll(".node")
				  	.data(bubble.nodes(classes(root))
				  	.filter(function(d) {
				  		return !d.children;
				  	}))
					.enter()
						.append("g")
      			.attr("class", "node")
      			.attr("transform", function(d) { 
      				return "translate(" + d.x + "," + d.y + ")"; 
      			});
					
				node.append("title")
      		.text(function(d) { 
      			return d.className + ": " + format(d.value); });
				
				node.append("circle")
    			.attr("r", function(d) { 
    				return d.r; 
    			})
					.attr("fill", function(d) {
						if (d.timeline.value == "http://www.semanticweb.org/hbailey/ontologies/2013/9/mitorg#ongoing") {return "white"}
						else {return "gray"}
					})

			  node.append("text")
			    .attr("dy", ".3em")
			    .style("text-anchor", "middle")
			    .text(function(d) { 
			      return d.className.substring(0, d.r / 3); 
			    })

			  });

			// Returns a flattened hierarchy containing all leaf nodes under the root.
function classes(root) {
  var classes = [];

  function recurse(name, node) {
    if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
    else classes.push({packageName: name, className: node.name, value: node.size});
  }

  recurse(null, root);
  return {children: classes};
}

d3.select(self.frameElement).style("height", diameter + "px");

			</script>
			</body>
			</html>